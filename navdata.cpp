#include "navdata.h"
#include "gps.h"
#include <Arduino.h>


LatLonManager::LatLonManager() : currentIndex(0), count(0) {}


int magc = 0;
float dest_dist = 0;
extern int destination_mode;


// Convert degrees to radians
float deg2rad(float degrees) {
  return degrees * PI / 180.0;
}


double rad2deg(double rad) {
  return rad * (180.0 / PI);
}


// Function to calculate distance using Haversine formula
double calculateDistance(double lat1, double lon1, double lat2, double lon2) {
  // Convert latitude and longitude from degrees to radians
  lat1 = deg2rad(lat1);
  lon1 = deg2rad(lon1);
  lat2 = deg2rad(lat2);
  lon2 = deg2rad(lon2);

  // Haversine formula
  double dlon = lon2 - lon1;
  double dlat = lat2 - lat1;
  double a = pow(sin(dlat / 2), 2) + cos(lat1) * cos(lat2) * pow(sin(dlon / 2), 2);
  double c = 2 * atan2(sqrt(a), sqrt(1 - a));
  double distance = RADIUS_EARTH_KM * c;

  return distance;
}


double calculateTrueCourseRad(double lat1, double lon1, double lat2, double lon2) {
  double deltaLon = lon2 - lon1;
  return atan2(sin(deltaLon) * cos(lat2), cos(lat1) * sin(lat2) - sin(lat1) * cos(lat2) * cos(deltaLon));
}


void nav_update(){
  // ====Navigation.==== Distance to plathome.
  if(currentdestination != -1 && currentdestination < destinations_count){
    double destlat = extradestinations[currentdestination].cords[0][0];
    double destlon = extradestinations[currentdestination].cords[0][1];
    dest_dist = calculateDistance(get_gps_lat(), get_gps_lon(), destlat, destlon);
    magc = (int)((rad2deg(calculateTrueCourseRad(deg2rad(get_gps_lat()), deg2rad(get_gps_lon()), deg2rad(destlat), deg2rad(destlon))) + 368)) % 360;
    if(destination_mode == DMODE_FLYAWAY){
      magc = (magc+180)%360;
    }
  }
}



void LatLonManager::addCoord(Coordinate position) {
  coords[currentIndex] = position;
  currentIndex = (currentIndex + 1) % MAX_TRACK_CORDS;
  if (count < MAX_TRACK_CORDS) {
    count++;
  }
}

int LatLonManager::getCount() {
  return count;
}

void LatLonManager::printData() {
  for (int i = 0; i < count; i++) {
    Serial.print("Coordinate ");
    Serial.print(i + 1);
    Serial.print(": Latitude = ");
    Serial.print(coords[i].latitude, 6);
    Serial.print(", Longitude = ");
    Serial.println(coords[i].longitude, 6);
  }
}

void LatLonManager::reset(){
  count = 0;
  currentIndex = 0;
}

Coordinate LatLonManager::getData(int newest_index) {
  if (newest_index >= count || newest_index < 0) {
    Serial.println("Invalid index");
    return {0, 0};
  }
  int index = (currentIndex - 1 - newest_index + MAX_TRACK_CORDS) % MAX_TRACK_CORDS;
  return coords[index];
}

LatLonManager latlon_manager;


// Function to convert latitude from degrees to radians
double deg2rad(double degrees) {
  return degrees * PI / 180.0;
}
// Function to calculate y-coordinate in Mercator projection
double latitudeToMercatorY(double latitude) {
  double radLatitude = deg2rad(latitude);
  return log(tan(PI / 4.0 + radLatitude / 2.0));
}





bool check_within_latlon(double latdif,double londif,double lat1,double lat2,double lon1,double lon2){
  return (abs(lat1-lat2) < latdif) && (abs(lon1-lon2) < londif);
}


mapdata extramaps[MAX_MAPDATAS];
int current_id = 100;
int mapdata_count = 0;

mapdata extradestinations[MAX_DESTINATIONS];
int destinations_count = 0;
int currentdestination = -1;

char* strdup(const char* str) {
    if (str == nullptr) return nullptr;  // Handle nullptr case
    // Calculate the length of the input string
    int len = 0;
    while (str[len] != '\0') {
        len++;
    }
    // Allocate memory for the duplicate string
    char* dup = new char[len + 1];  // +1 for the null terminator
    // Copy the string into the allocated memory
    for (int i = 0; i <= len; i++) {
        dup[i] = str[i];
    }
    return dup;
}

// Static mapdata definition using a helper function
mapdata create_static_mapdata(int id, const char* name, int size, const double cords[]) {
  mapdata new_mapdata;
  new_mapdata.id = id;
  new_mapdata.name = strdup(name); // Duplicate string to allocate memory
  new_mapdata.size = size;
  new_mapdata.cords = new double[size][2];
  for (int i = 0; i < size; i++) {
    new_mapdata.cords[i][0] = cords[i * 2];
    new_mapdata.cords[i][1] = cords[i * 2 + 1];
  }
  return new_mapdata;
}



const bool filldata[ROW_FILLDATA][COL_FILLDATA] = {
false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,
false,false,false,false,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,
false,false,false,false,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,
false,false,false,false,true,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,
false,false,false,false,false,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,
false,false,false,false,false,false,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,
false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,
false,false,false,false,false,false,false,true,true,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,
false,false,false,false,false,false,false,true,true,true,true,true,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,
false,false,false,false,false,false,false,true,true,true,true,true,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,
false,false,false,false,false,false,false,true,true,true,true,true,true,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,
false,false,false,false,false,false,false,false,true,true,true,true,true,true,true,true,true,false,false,false,false,false,false,false,false,false,false,false,
false,false,false,false,false,false,false,false,false,true,true,true,true,true,true,true,true,true,true,false,false,false,false,false,false,false,false,false,
false,false,false,false,false,false,false,false,false,false,true,true,true,true,true,true,true,true,true,true,true,false,false,false,false,false,false,false,
false,false,false,false,false,false,false,false,false,false,false,false,true,true,true,true,true,true,true,true,true,true,true,false,false,false,false,false,
false,false,false,false,false,false,false,false,false,false,false,false,true,true,true,true,true,true,true,true,true,true,true,false,false,false,false,false,
false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,true,true,true,true,true,true,true,true,true,false,false,false,false,
false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,true,true,true,true,true,true,true,true,true,false,false,false,false,
false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,true,true,true,true,true,true,true,true,true,false,false,false,false,
false,false,false,false,false,false,false,false,false,false,false,false,true,true,true,true,true,true,true,true,true,true,true,false,false,false,false,false,
false,false,false,false,false,false,false,false,false,false,false,false,true,true,true,true,true,true,true,true,true,false,false,false,false,false,false,false,
false,false,false,false,false,false,false,false,false,false,false,false,false,true,true,true,true,true,true,true,true,false,false,false,false,false,false,false,
false,false,false,false,false,false,false,false,false,false,false,false,false,true,true,true,true,true,true,true,false,false,false,false,false,false,false,false,
false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,true,false,true,true,false,false,false,false,false,false,false,false,
false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,true,true,false,false,false,false,false,false,false,false,
false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,
false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false
};



const double map_okishima_coords[] = {
  136.0769088607755, 35.21038374683805,
  136.0708233623226, 35.21241872134723,
  136.0623026873304, 35.20950590839073,
  136.0535721871087, 35.21055415403649,
  136.0552235797892, 35.2038605237371,
  136.0505054301688, 35.19897385483104,
  136.0579600332858, 35.19990514421023,
  136.0633659977478, 35.20558123298269,
  136.0679873597187, 35.20313886524324,
  136.0769088607755, 35.21038374683805
};


const double map_shinura_coords[] = {
  139.8946356790473,35.63477147414148,
  139.8993962764904,35.63110435074648,
  139.9002186788533,35.63184812546795,
  139.9008942475155,35.63125868543327,
  139.9004808672615,35.63082071949847,
  139.9017683882747,35.62979845567328,
  139.905309740396,35.63276837386708,
  139.9070412556721,35.63142355706371,
  139.9047568234965,35.629384210175,
  139.9048220323033,35.6285672291831,
  139.9101594917179,35.62430394795486,
  139.9255366540211,35.63283614382335,
  139.9248309637531,35.63329607165124,
  139.9240439847594,35.63280712494947,
  139.9233251312328,35.6332986364198,
  139.9241865249091,35.63394884889712,
  139.9132598107083,35.64273479918383,
  139.902058875763,35.65167210976476,
  139.9003122200594,35.65312588152109,
  139.9006823423278,35.65368394237774,
  139.902332057434,35.65205382762832,
  139.9246833409793,35.63426801685366,
  139.9262118128646,35.63321951767619,
  139.9396948447581,35.64067293500552,
  139.9396172604242,35.64116657883129,
  139.9366494390052,35.64334513962186,
  139.9238356810629,35.651579929176,
  139.9179629203061,35.65551661369825,
  139.9123317898366,35.65919457306638,
  139.9076897744661,35.66222837752126
};


const double map_takeshima_coords[] = {
  136.1791589861376,35.29716068038715,
  136.1777344333285,35.29669382781091,
  136.1772921019273,35.29600789212441,
  136.1782442605164,35.29614077343304,
  136.1791589861376,35.29716068038715,
};
const double map_chikubushima_coords[] = {
  136.1408267964406,35.41939915652542,
  136.1439237744329,35.41973966541397,
  136.1458430188931,35.42190963520056,
  136.1454323899703,35.42511206237064,
  136.1438652329591,35.42333719768954,
  136.1426500169115,35.4243034801035,
  136.1417556191338,35.42223281537326,
  136.140243732289,35.42034015096833,
  136.1408267964406,35.41939915652542
};

const double map_biwako_coords[] = {
  136.2453288454566,35.28236467197092,
  136.2429652046184,35.28373280870955,
  136.2493659056991,35.28779347675736,
  136.250076287017,35.28737444973097,
  136.2553833973682,35.29236709541164,
  136.2573264953538,35.29532555963946,
  136.2553090784124,35.295985238208,
  136.2547505077028,35.29826655657218,
  136.253381542851,35.30028466602685,
  136.2654981384807,35.31627551402599,
  136.2702685951747,35.32677287377201,
  136.2677341832543,35.32981159182847,
  136.2725702357528,35.33468882073906,
  136.2772453435636,35.34540210862981,
  136.2770580426969,35.36296673000132,
  136.2535761114115,35.38282084644397,
  136.2304243955057,35.39012685868764,
  136.2142422540571,35.38687483431432,
  136.2166273527625,35.40181216337505,
  136.200962404843,35.41619394812336,
  136.1986807033571,35.430942756813,
  136.1863230082727,35.45203827811862,
  136.1996567752855,35.45751340322091,
  136.1977341189523,35.47248914516708,
  136.1881605483771,35.49630073706879,
  136.1669899646391,35.51188579375383,
  136.1602135588679,35.48850583564352,
  136.15248195511,35.46613901612719,
  136.1540257753243,35.4485212140121,
  136.1418361550141,35.44403220917452,
  136.1424501209119,35.45686366653519,
  136.1251346214454,35.45626743508952,
  136.1327226949435,35.48098612947456,
  136.116430718935,35.48335502339528,
  136.10455096899,35.45514953764883,
  136.086990825114,35.44984708558302,
  136.0777484783935,35.4643845118285,
  136.0540722756077,35.45011409399385,
  136.0425700901165,35.42999540050764,
  136.0460481683708,35.4069909184199,
  136.0385136511862,35.40324289306536,
  136.0376967200626,35.37997832851608,
  136.0637457059078,35.35980093509941,
  136.0775308374164,35.32868667352093,
  136.0761983745897,35.31499831248527,
  136.0609521680693,35.31676158568307,
  136.0471481251578,35.30247002173223,
  136.0346558937316,35.30418643983462,
  136.0140324465513,35.29233050622074,
  136.0211146188245,35.27895736543612,
  135.9792060495034,35.25898924751611,
  135.9720025012076,35.24483274117927,
  135.9597735513515,35.23455403532313,
  135.9649621516172,35.22574412388214,
  135.9333471013614,35.20815950385362,
  135.9183292111347,35.17387316819992,
  135.9349034767044,35.1538000146947,
  135.9223400057318,35.1419714656227,
  135.9293242411652,35.12601756432628,
  135.9169546202946,35.10091359469968,
  135.8877799750925,35.07756955530406,
  135.864063604824,35.02457799195169,
  135.8694895443669,35.00959796960318,
  135.8949049964245,35.00522797834628,
  135.9058545060879,34.9806220077318,
  135.9156334433563,35.01918672529627,
  135.9041047674939,35.0382764118251,
  135.9298827312521,35.05734073243784,
  135.940161496054,35.08344782960707,
  135.9438350416012,35.11989694777111,
  135.9528625441002,35.12658821253986,
  135.9630756443998,35.12163755071557,
  135.9741956116748,35.12337338572355,
  135.9818404924619,35.13179496757365,
  135.9874795092556,35.14444515540779,
  136.0043562101517,35.13572677947722,
  136.0197333292642,35.14646129772946,
  136.0488572017744,35.14016311433176,
  136.0647246529973,35.14657087466352,
  136.0643318925626,35.15640186112456,
  136.0574466044268,35.17667175673638,
  136.0700715003959,35.19027766603604,
  136.0892860392984,35.1912910861133,
  136.0875513403797,35.1988921916825,
  136.0843184933212,35.20244456845873,
  136.090907298077,35.20505063463008,
  136.0972223449205,35.20065854367763,
  136.1084841563289,35.20447313854737,
  136.1097457042426,35.21716352854781,
  136.1420454310799,35.22171512215966,
  136.1695117629879,35.23859105676829,
  136.2170558893299,35.26266521642599,
  136.2176253097184,35.26712240071485,
  136.2218690806408,35.26737415409594,
  136.2353234416846,35.27505406888672,
  136.2453288454566,35.28236467197092
};
const double map_handaioutside_coords[] = {
  135.4886236527158,34.83002026530426,
135.4889962188252,34.82469915723961,
135.4934601841001,34.81230132856709,
135.499779740941,34.81363611992104,
135.5042958399623,34.81737630516033,
135.5115598944098,34.81068298493258,
135.5159489073391,34.81089768495469,
135.5134822958925,34.81570935399444,
135.5109306555292,34.8211031076365,
135.5072440443363,34.82608173272482,
135.499549592877,34.83035452559445,
135.4984652269781,34.83413621031295,
135.5023745611614,34.83518698624572,
135.507726098019,34.83564163124254,
135.5153376582334,34.83577757383128,
135.5154947213441,34.83376736856319,
135.5161065000802,34.83024558019009,
135.5158675553951,34.82857293305862,
135.516127523331,34.82727388718998,
135.517360947942,34.82576589758838,
135.517517056979,34.82492222066032,
135.5171017415715,34.8240036248263,
135.5177152914927,34.82353857339502,
135.5200874196052,34.82246049018575,
135.5203974681629,34.82133129776793,
135.51966204979,34.82015863801803,
135.5192968455686,34.81743018154395,
135.5194994667812,34.81572477061772,
135.5187083037661,34.81395055749358,
135.5160788533039,34.81124448537869,
135.5172825182793,34.80937611141903,
135.5180016514732,34.81018355860668,
135.5175692070068,34.81092844616481,
135.5186303347167,34.81199399738044,
135.5209094593572,34.81209769126325,
135.5257586202844,34.81629460407122,
135.520900092197,34.81207809510725,
135.5203977034051,34.81020601011961,
135.5227203181792,34.80745338924606,
135.5280243740033,34.80406407348704,
135.5340987227816,34.80277998792202,
135.5380565584433,34.80450237126545,
135.5396474804874,34.81081376255133,
135.5389612217641,34.81321768357751,
135.5340582780971,34.81469106837893,
135.5295641873243,34.81618838912017,
135.5273975266068,34.81670062156046,
135.5257571207703,34.81628964133991,
135.5273829086462,34.81668487811491,
135.5295884540204,34.81619115171294,
135.529800743125,34.81714058247767,
135.5301425561633,34.81973592956236,
135.5275609159398,34.83102837168807,
135.5266587129085,34.83608740370632,
135.5426255182958,34.8363844864101,
135.5551711588323,34.83635480731414,
135.562334886935,34.82853965901526,
135.5700639325516,34.83149645122305,
135.5671954604985,34.84349573976401,
135.5671748868228,34.8554701292979,
135.5636385192465,34.86499147038762,
135.5545066968347,34.87671003184703,
135.5515170738355,34.88210396688621,
135.5405473290972,34.87960112720334,
135.5329160210004,34.88340504643339,
135.5221145959146,34.87435340392013,
135.5348672737379,34.86390675448425,
135.5277740814594,34.86021537867586,
135.5230418622749,34.85614469497724,
135.5217417304277,34.84996035039993,
135.5218945709854,34.84369502775861,
135.526502000889,34.83885569856469,
135.5266608874051,34.83607505452488,
135.5153546240302,34.83579558844479,
135.5147014017668,34.83838588697532,
135.5162033574176,34.84103567436462,
135.5168082263485,34.84285185816889,
135.5152670828406,34.84338616591315,
135.5133467516317,34.84585248982998,
135.5061597732078,34.84472407973706,
135.5036238907301,34.84385490236347,
135.4968409730373,34.84089484927993,
135.4975592089948,34.83604850985738,
135.4985191637665,34.83412156726729,
135.4886236527158,34.83002026530426
};

const double map_handaihighway_coords[] = {
  135.2919766703268,34.82837511747447,
135.320657991067,34.82133520007292,
135.3302936937067,34.82252443927133,
135.3537875341487,34.81705098431264,
135.3706653610012,34.80591838792454,
135.3764679056429,34.80570578597841,
135.3896188580854,34.81032308241407,
135.4070405506025,34.81102188043336,
135.4251274365064,34.81054709674935,
135.4373742827077,34.80137142539753,
135.4466059860585,34.79980474195187,
135.4557572568827,34.80110036154443,
135.4657433432215,34.79973081146891,
135.4773510305108,34.80471044690934,
135.4931386553174,34.80665933423054,
135.5046978524636,34.80706202778127,
135.5160010177071,34.80572309517391,
135.5231006132117,34.80698724029931,
135.5393734313193,34.80768041461451,
135.5577343079876,34.8083040553582,
135.5613460188478,34.80761954939811,
135.5669882166196,34.80045153434467,
135.5669850394806,34.79736433864149,
135.560745843585,34.77863192421765,
135.5626301772432,34.77319819436347,
135.5745798816736,34.75757698842251,
135.5821021580458,34.74238885012384,
135.5826770973382,34.72666339598693,
135.5891073948839,34.7156394011711
};
const double map_handaihighway2_coords[] = {
  135.44588145832,34.7444489641071,
  135.466505306639,34.75482092807188,
  135.4926828314341,34.7616370812935,
  135.5042869092798,34.77118628202819,
  135.5195870345565,34.77592107264577,
  135.5352569756113,34.79132001061255,
  135.5387891789514,34.79711584719897,
  135.5444121599329,34.80908454888896,
  135.5531986248832,34.82189177414612,
  135.5595354179282,34.83070407558225,
  135.5821689694532,34.85137383136014,
  135.6166841513287,34.86756777151034,
  135.6254484019459,34.86730521898983,
  135.6403605373168,34.86235625685767,
  135.6509362801736,34.86817838427577
};
const double map_handaiinside1_coords[] = {
  135.5192546630597,34.82290122322834,
  135.5202608927341,34.82473714307037,
  135.5206192267198,34.82486547821112,
  135.5217566743228,34.82453841549704,
  135.5244832613544,34.82355410608935,
  135.5250823824439,34.82324933976636,
  135.5267673351993,34.82159632903841,
  135.5267177871875,34.8212531312041,
  135.5261512088265,34.820690594109,
  135.5252942965001,34.82033917705255,
  135.5244373365641,34.81942598165465,
  135.5242214600272,34.81906565250041,
  135.5256380375261,34.81859729141113,
  135.5247158404168,34.81729424042686,
  135.5252446824773,34.81694258980153,
  135.5257522649573,34.81629080476041
};
const double map_handaiinside2_coords[] = {
  135.5286365645366,34.82568485125642,
  135.5273128013348,34.82549139911511,
  135.5261273662329,34.82554391784173,
  135.5254161526343,34.82517085459351,
  135.5244468888839,34.82354534706387
};
const double map_handaiinside3_coords[] = {
  135.5267331073241,34.82133387379517,
  135.5272059493836,34.82108416686005,
  135.5278977953256,34.82100216147467,
  135.528146269457,34.82106616633,
  135.529093955624,34.82091067930091,
  135.5295367759326,34.82067872443532,
  135.5295844950343,34.82034217934558,
  135.5295209430969,34.81975800482471,
  135.5301028726996,34.81969461270889
};
const double map_handaiinside4_coords[] = {
  135.5298121242363,34.81706877893021,
  135.5283966354298,34.8177316121194,
  135.5293706790027,34.81885231412389,
  135.5294961829965,34.81976659237854,
  135.5291018988957,34.81982356034222,
  135.5290421344131,34.81914923603694,
  135.5293880045558,34.81909154410851,
  135.5293796309032,34.81885345398125,
  135.5283935365026,34.81770532516372,
  135.5273655622806,34.81810440892493,
  135.5256027870635,34.81860849241601,
  135.5250884665181,34.81878295185591,
  135.5252858782623,34.81916263538049,
  135.5245482800287,34.81955098896822,
  135.5244482112157,34.81945038187022,
  135.5241533909122,34.81960023635778,
  135.5239282663402,34.81957430691934,
  135.5237028220277,34.8192410143936,
  135.5242211303909,34.81907006999748,
  135.5237046505857,34.81924344665654,
  135.5224634013304,34.81985548296133,
  135.5209487140366,34.82070440413926,
  135.5203786293369,34.82175959067454
};
const double map_handaiinside5_coords[] = {
  135.5224490054155,34.81983638295585,
  135.5217425718252,34.81894459807737,
  135.52138305435,34.81849558741609,
  135.5211988415703,34.81759455392782,
  135.5223054627608,34.81753896709042,
  135.5237609911553,34.81672296814051,
  135.5240946255629,34.81665363436559,
  135.5247054321576,34.81729110638855,
  135.5217293474069,34.81895734917615,
};
const double map_handairailway_coords[] = {
  135.6512900479658,34.86505554647611,
  135.6261271246183,34.8558228850904,
  135.5876045781108,34.83425382341493,
  135.5688579383831,34.82329415151023,
  135.5605410163086,34.81257614753417,
  135.5451305011336,34.78012561482964,
  135.5134857526336,34.75439898128973,
  135.5082960697691,34.74949744725232,
  135.5016934812638,34.73392941571991,
  135.5031603039674,34.71640892082067,
  135.5016258761365,34.70645144393945,
  135.4896595481223,34.69881453423703,
  135.4778970720051,34.70200983976291,
  135.4568340529023,34.72584445850289,
  135.3929511812172,34.73880606817378,
  135.3273315971037,34.73876720830363,
  135.2074051853469,34.70410088899852,
  135.3145552422696,34.74129266484319,
  135.4449721297769,34.75380261291568,
  135.474278749778,34.73129043250403,
  135.4894070154188,34.71013272641515,
  135.4980560274448,34.70786384018691,
  135.4985417876908,34.7048003408009
};
const double map_handaicafe_coords[] = {
  135.5221316636889,34.82304448212256,
  135.5219602001092,34.8231062484271,
  135.5220512052736,34.8232288460149,
  135.5222213470718,34.82322483897624,
  135.5223210581044,34.82336042253564,
  135.5222094422173,34.82346143689536,
  135.5220043159746,34.82350711676857,
  135.5216910472552,34.82295557500845,
  135.5220290308307,34.82283299191694,
  135.5221316636889,34.82304448212256
};
const double map_japan1_coords[] = {
  131.65979027600008, 32.47681957400005,
131.619476759, 32.337103583000044,
131.45857033700008, 31.905451862000064,
131.450531446, 31.65110911700009,
131.391449415, 31.516750393000052,
131.34058678500003, 31.378729559000078,
131.26587975400003, 31.38117096600007,
131.17863301300008, 31.452428893000047,
131.02545128600002, 31.354095225000037,
131.13211394400003, 31.279513102000067,
130.92400149800005, 31.112982489000046,
130.67794304400002, 31.00501043400004,
130.79664629800004, 31.325345784000035,
130.619476759, 31.564276434000078,
130.7192488940001, 31.570705471000053,
130.73796468800003, 31.70843859000007,
130.54224694100003, 31.54173411700009,
130.6236819840001, 31.275646770000037,
130.5625106130001, 31.166937567000048,
130.27507571700005, 31.25299713700008,
130.20777428500003, 31.33661530200004,
130.19597415500004, 31.412054755000042,
130.33765709700003, 31.607896226000037,
130.181000196, 31.826971747000073,
130.19410241000003, 31.980902411000045,
130.278656446, 32.10053131700005,
130.357758009, 32.18724192900004,
130.469574415, 32.34711334800005,
130.56763756600003, 32.47768789300005,
130.65642337300005, 32.62372467700004,
130.576508009, 32.69839101800005,
130.5937606130001, 32.75560130400004,
130.44125410200002, 32.92365143400008,
130.40015709700003, 33.095038153000075,
130.258148634, 33.17865631700005,
130.22231019900005, 32.97520504800008,
130.12231510100003, 32.86881610800009,
130.37484785200002, 32.780178127000056,
130.25993899800005, 32.63271719000005,
130.1554875600001, 32.62565433600008,
130.20132314600005, 32.72425020600008,
130.1382142650001, 32.78884735300005,
129.96201159100008, 32.76180925300008,
129.84127669600002, 32.63941524900008,
129.7340049080001, 32.58092038700005,
129.803249284, 32.67799558400009,
129.82398522200003, 32.73607005400004,
129.72103494200007, 32.82707413800006,
129.631129363, 32.956533586000035,
129.734711134, 33.060248114000046,
129.7386319100001, 33.019118252000055,
129.81608896700004, 32.937947697000084,
129.8148143520001, 32.86331302600007,
129.9356096470001, 32.860488941000085,
129.881443666, 33.062762999000086,
129.74244225400003, 33.07636139500005,
129.72364464100008, 33.132775250000066,
129.6665145190001, 33.101263739000046,
129.652679884, 33.19025299700007,
129.56534239400003, 33.27206736000005,
129.62061608200008, 33.35927969000005,
129.81983483200008, 33.304754950000074,
129.86866295700008, 33.39744700700004,
129.86207116000003, 33.43699778900009,
129.94214928500003, 33.531683661000045,
129.9889460280001, 33.448851378000086,
130.1298934250001, 33.51898834800005,
130.09693444100003, 33.561712958000044,
130.1595475270001, 33.62959605400005,
130.22715623300007, 33.63484353900009,
130.29529753400004, 33.579042582000056,
130.40750100800005, 33.650468484000044,
130.29490003900003, 33.66435087500008,
130.4287215500001, 33.71369049700007,
130.46208743600005, 33.81118398600006,
130.56470787900003, 33.88328685100004,
130.790494512, 33.94441130800004,
130.9414168630001, 33.91681549700007,
131.00177079800005, 33.887228684000036,
130.96599368600005, 33.81305573100008,
131.10297618100003, 33.62425323800005,
131.42317582400005, 33.589053522000086,
131.6274520190001, 33.667669989000046,
131.7273475830001, 33.46353913000007,
131.60962975400003, 33.368801174000055,
131.52849368600005, 33.26121653900009,
131.902624533, 33.26604183300009,
131.86883062000004, 33.12876699900005,
131.929216945, 33.068270865000045,
131.99611291500003, 33.09171124900007,
131.93470534100004, 32.95950686200007,
132.013879094, 32.93439292900007,
131.98218834700003, 32.88890208500004,
131.99781334700003, 32.82965729400007,
131.87232506600003, 32.731634833000044,
131.81656441200005, 32.689146346000086,
131.7490340500001, 32.59406159100007,
131.71892337300005, 32.50873444200005
};
const double map_japan2_coords[] = {
  134.689789259, 33.82807038000004,
134.57937739500005, 33.76417006200006,
134.3529669180001, 33.58163085800004,
134.20777428500003, 33.339097398000035,
134.107960423, 33.31492348200004,
133.73939679, 33.537506879000034,
133.3916121750001, 33.389837958000044,
133.29224694100003, 33.36469147300005,
133.270843946, 33.25950755400004,
133.22543379, 33.159084377000056,
133.0898543630001, 33.01927317900004,
132.95509926500006, 32.85262854200005,
133.00220787900003, 32.71165599200009,
132.8720809250001, 32.768744208000044,
132.66464317600003, 32.77886830400007,
132.62720787900003, 32.906317450000074,
132.5322371750001, 32.89940013200004,
132.48140843600004, 33.02352753800005,
132.47152754, 33.05560944200005,
132.48015384200005, 33.11831289300005,
132.43810824600007, 33.191397889000086,
132.48570176400005, 33.169153220000055,
132.507701687, 33.25790311900005,
132.4012213750001, 33.30938686700006,
132.3906356130001, 33.374986070000034,
132.36296634200005, 33.468085028000075,
132.13943055100003, 33.37397803600004,
132.094319993, 33.40848712800005,
132.26463165100006, 33.464073502000076,
132.61848949800003, 33.67428922700009,
132.75748129400006, 33.93494834400008,
132.90620625300005, 34.11316541800005,
133.0318488380001, 34.052734410000085,
133.24368022400006, 33.95625729500006,
133.51099694100003, 33.96523672100005,
133.64600670700008, 34.16738515800006,
133.637543165, 34.233587958000044,
133.8906356130001, 34.35219961100006,
134.01197350400003, 34.348822333000044,
134.1274520190001, 34.38979726800005,
134.2168074880001, 34.35504791900007,
134.384125196, 34.250067450000074,
134.5942488940001, 34.232123114000046,
134.625747865, 34.201014144000055,
134.62273196700005, 34.134466864000046,
134.61163713300004, 33.997020270000064,
134.70289147200003, 33.906236070000034,
134.6982528000001, 33.83624909100007
};
const double map_japan3_coords[] = {
  133.422211134, 34.445013739000046,
133.2959090500001, 34.345038153000075,
133.22966556100005, 34.376166083000044,
133.160980665, 34.294175523000035,
133.08741295700008, 34.32648346600007,
133.15259850400003, 34.37384674700007,
132.91187584700003, 34.31476471600007,
132.77808678500003, 34.24274323100008,
132.61353600400003, 34.218451239000046,
132.53345787900003, 34.24477773600006,
132.53101647200003, 34.335150458000044,
132.31234785200002, 34.32697174700007,
132.19906660200002, 34.06476471600007,
132.16163170700008, 33.84170156500005,
132.078461134, 33.83490631700005,
131.99480228000004, 33.91347890800006,
131.81226647200003, 33.97142161700009,
131.79957116000003, 34.03774648600006,
131.59327233200008, 34.03729889500005,
131.56226647200003, 34.00462474200009,
131.47429446700005, 34.01398346600007,
131.4282332690001, 33.98590729400007,
131.38990319100003, 34.03974030200004,
131.22584069100003, 33.93500397300005,
131.173187696, 33.93398672100005,
131.03559480800004, 34.04797509500008,
130.8994246750001, 33.94985586100006,
130.87322024800005, 34.078192450000074,
130.920258009, 34.192572333000044,
130.88624108200008, 34.300441799000055,
131.0117293630001, 34.37596263200004,
130.9477645190001, 34.41893138200004,
131.06120853000004, 34.42084381700005,
131.17359459700003, 34.410223700000074,
131.25102696400006, 34.41913055400005,
131.28448215100002, 34.384211288000074,
131.461761915, 34.523504950000074,
131.5942488940001, 34.62567780200004,
131.746081807, 34.675353457000085,
131.92378849800002, 34.78785980400005,
132.157940371, 34.97613237400009,
132.386574258, 35.14553759200004,
132.63867918900007, 35.29464467300005,
132.63535916900003, 35.44095469500007,
132.7527198370001, 35.47707763500006,
133.0143994870001, 35.540780117000054,
133.14142764200005, 35.57016529100008,
133.266376798, 35.574236505000044,
133.25416100400003, 35.52179596600007,
133.49275500400006, 35.51036183600007,
134.26206575800006, 35.55358778700008,
134.5369873090001, 35.67220309900006,
134.88096824600007, 35.657322495000074,
135.010843852, 35.69111295300007,
135.2617293630001, 35.73981354400007,
135.2327554000001, 35.61421404300006,
135.25342858200008, 35.57127513200004,
135.33548989200006, 35.50821008500009,
135.394867384, 35.47646719000005,
135.42595462300005, 35.56981028900009,
135.47868899800005, 35.52728913000004,
135.55827884200005, 35.49176666900007,
135.63461347700002, 35.49355703300006,
135.69163589700008, 35.54587719600005,
135.81617272200003, 35.54596588700008,
135.834320509, 35.61318594000005,
135.91944111600003, 35.60816038200005,
135.95644806000007, 35.70056518700005,
136.027006444, 35.68094741500005,
136.0929581580001, 35.743115180000075,
135.99438018900003, 35.93591278200006,
136.1075493940001, 36.18516511200005,
136.3467788480001, 36.365800910000075,
136.7519586190001, 36.93541643100008,
136.70856414900004, 37.14987732700007,
136.7127711610001, 37.25106551400006,
136.934766136, 37.39945701800008,
137.3452992980001, 37.475020106000045,
137.237363609, 37.37988162000005,
137.10872138900004, 37.28344965100007,
136.945883008, 37.21718561900008,
136.8956676370001, 37.13890407800005,
136.963226759, 37.05174388200004,
137.025040116, 36.91394722700005,
137.33334435900008, 36.762726067000074,
137.4993469650001, 36.95574161700006,
138.2069532590001, 37.16920530200008,
138.7465926440001, 37.596869208000044,
139.21594314100003, 37.98993395400004,
139.5800887380001, 38.60687897300005,
139.88062584700003, 39.11473216400009,
140.04857715000003, 39.50466964600008,
139.8642684250001, 39.88222890800006,
139.71943758300006, 39.952141356000084,
139.993500196, 40.169623114000046,
139.94263756600003, 40.43439362200007,
139.88038466, 40.625232554000036,
140.09513809700002, 40.74927419200009,
140.29664147200003, 40.87376536700003,
140.36959444000001, 40.98605469100005,
140.37897206000002, 41.038166566000086,
140.3001619810001, 41.11127729200007,
140.33277428500003, 41.19131094000005,
140.40943444100003, 41.224676825000074,
140.63701139400007, 41.14474739600007,
140.79922346800004, 40.83908125100004,
140.8472456400001, 40.94760752700006,
140.88867495600005, 41.01077779500008,
140.9794214110001, 40.95143509800005,
141.073919208, 40.90012069800008,
141.24190264900005, 41.08274200000005,
141.20591119200003, 41.26471970400007,
141.15911483900004, 41.25669431400007,
140.9920538990001, 41.19335164900008,
140.79815518300006, 41.128577901000085,
140.8031479340001, 41.32954397600008,
140.9057158930001, 41.51308858200008,
141.00333950800007, 41.48708488900007,
141.276095682, 41.35319552800007,
141.4604310750001, 41.41335629300005,
141.42379443000004, 41.312706921000085,
141.38630694100004, 41.03036180100008,
141.5196960080001, 40.537986372000034,
141.719140981, 40.41283517800008,
141.830414259, 40.251166083000044,
141.87720787900003, 40.13930898600006,
141.95533287900003, 39.97492096600007,
141.97543379, 39.85219961100006,
141.98389733200008, 39.70697663000004,
142.03077233200008, 39.61749909100007,
142.05933678500003, 39.533270575000074,
142.02881920700008, 39.47793203300006,
142.00114993600005, 39.41364166900007,
141.92465254, 39.32489655200004,
141.9243270190001, 39.275824286000045,
141.90211022200003, 39.204331773000035,
141.90886478000004, 39.10976797100005,
141.8232528000001, 39.056708075000074,
141.72820071700005, 39.02171458500004,
141.717133009, 38.94684479400007,
141.64527428500003, 38.92300039300005,
141.61784915500004, 38.88544342700004,
141.52165774800005, 38.76813385600008,
141.54281660200002, 38.70726146000004,
141.5322371750001, 38.63841380400004,
141.54224694100003, 38.53343333500004,
141.50074303500003, 38.457912502000056,
141.48755944100003, 38.39203522300005,
141.5293074880001, 38.339544989000046,
141.4599715500001, 38.306341864000046,
141.410492384, 38.37791575700004,
141.17212975400003, 38.347316799000055,
141.079437696, 38.36090729400007,
141.06226647200003, 38.28473541900007,
140.95926646200007, 37.849958763000075,
141.01140384200005, 37.67226797100005,
140.98796634200005, 37.08978913000004,
140.80437259200005, 36.885972398000035,
140.61011803500003, 36.43390534100007,
140.646034105, 36.013320444000044,
140.8606646720001, 35.68779101800004,
140.4834674970001, 35.56599105500004,
140.33047969900008, 35.15778336400007,
140.134602814, 35.12264536400005,
139.964648033, 34.95928462900008,
139.83814537900003, 34.90468984600005,
139.783621895, 34.97425062900004,
139.8559676440001, 35.020819403000075,
139.82211347700002, 35.17059967700004,
139.78100337900003, 35.31806065600006,
139.9128234540001, 35.434436180000034,
140.102048684, 35.56708749400008,
139.95041397400007, 35.67259201500008,
139.84327233200008, 35.628892320000034,
139.7581622360001, 35.63156424200008,
139.71407684000008, 35.46473072500004,
139.67457116000003, 35.400824286000045,
139.66438993500003, 35.29878081000004,
139.68879598, 35.20913368600009,
139.61628493600006, 35.134001708000085,
139.56625410200002, 35.27606842700004,
139.2820504240001, 35.29619758400008,
139.1059676440001, 35.04938385600008,
139.099072944, 34.85611941800005,
138.99875872200005, 34.73328434200005,
138.9408259810001, 34.661107187000084,
138.76685631600003, 34.676214911000045,
138.74812686400003, 34.81320925300008,
138.7739363940001, 34.931626695000034,
138.8534354960001, 35.07822164400005,
138.49788298200008, 35.03256950200006,
138.367107895, 34.917309439000064,
138.24950579000006, 34.73902319000007,
137.96758503500007, 34.666540387000055,
137.04482177, 34.58063023500006,
137.11085045700008, 34.625433661000045,
137.29822593400002, 34.728215300000045,
137.32431631200006, 34.766844656000046,
137.18873911600008, 34.770111700000086,
137.028817086, 34.78015714400004,
136.95679772200003, 34.884833075000074,
136.94539164900004, 34.69847069000008,
136.856286199, 34.85649521600004,
136.8658805010001, 35.02569016400008,
136.83932725500006, 35.03251957900005,
136.6591903000001, 34.98395416900007,
136.61611454500007, 34.85350057100004,
136.54566491000003, 34.639878648000035,
136.752289259, 34.513332424000055,
136.8833113940001, 34.437567450000074,
136.87525475400003, 34.36933014500005,
136.90023847700002, 34.282538153000075,
136.80925540500004, 34.273871161000045,
136.80746504, 34.307847398000035,
136.72339928500003, 34.331284898000035,
136.57406660200002, 34.280503648000035,
136.51482181100005, 34.229803778000075,
136.3164168630001, 34.11432526200008,
136.24634850400003, 34.103583075000074,
136.27662194100003, 34.01239655200004,
136.20484459700003, 33.96523672100005,
136.1425887380001, 33.89362213700008,
135.95728600400003, 33.62571849200009,
135.79799322100007, 33.495161487000075,
135.637543165, 33.49461497600004,
135.36939537900003, 33.644964911000045,
135.312102234, 33.76552878400008,
135.06545384900005, 33.88557181900006,
135.1012224010001, 33.954437547000055,
135.15308678500003, 34.04857005400004,
135.12283938400003, 34.137101115000064,
135.06104364700002, 34.267274919000045,
135.37320827300005, 34.51893221900008,
135.39757432300007, 34.686213783000085,
135.24234854000008, 34.650751996000054,
134.960297071, 34.64362213700008,
134.559906446, 34.76829661700009,
134.49048912900003, 34.77260976800005,
134.43140709700003, 34.730454820000034,
134.3266707690001, 34.704331773000035,
134.24480228000004, 34.691473700000074,
134.1796981130001, 34.63231028900009,
133.97925866000003, 34.605902411000045,
134.0356551440001, 34.593410549000055,
133.96656334700003, 34.50641510600008,
133.7368270190001, 34.502386786000045,
133.58619225400003, 34.47573476800005,
133.5224715500001, 34.48305898600006,
};
const double map_japan4_coords[] = {
  145.76742597700002, 43.38727448100008,
145.70850670700008, 43.32632070500006,
145.5722762380001, 43.25698476800005,
145.45240319100003, 43.18390534100007,
145.11931399800005, 43.10610586100006,
145.09929446700005, 43.044623114000046,
144.899750196, 42.97947825700004,
144.79086347700002, 43.044623114000046,
144.77125084700003, 42.94489166900007,
144.368500196, 42.978176174000055,
143.5752059250001, 42.60333893400008,
143.292328321, 42.005194403000075,
143.1152449880001, 42.02798086100006,
141.92595462300005, 42.558579820000034,
141.21509850400003, 42.444525458000044,
140.97730553500003, 42.29962799700007,
140.9746199880001, 42.34662506700005,
140.52564537900003, 42.58063385600008,
140.321625196, 42.23395416900007,
140.77361087300005, 42.10219961100006,
141.0595809250001, 41.88711172100005,
141.0063582690001, 41.712144273000035,
140.7334090500001, 41.79364655200004,
140.53484134200005, 41.70526764500005,
140.2412215500001, 41.45722077000005,
140.0629988940001, 41.431341864000046,
140.071136915, 41.760199286000045,
140.12387129, 41.86595286700003,
140.1450301440001, 41.98265208500004,
139.84343509200005, 42.20856354400007,
139.84929446700005, 42.51414622600004,
140.11548912900003, 42.74209219000005,
140.28150475400003, 42.75726959800005,
140.50318444100003, 42.98004791900007,
140.33806399800005, 43.21051666900007,
140.48715254, 43.372381903000075,
140.77125084700003, 43.21552155200004,
141.0219832690001, 43.174994208000044,
141.30396569100003, 43.197251695000034,
141.37452233200008, 43.560532945000034,
141.40211022200003, 43.803615627000056,
141.66716556100005, 44.025091864000046,
141.5864363940001, 45.16437409100007,
141.65015709700003, 45.35736725500004,
141.69214928500003, 45.40228913000004,
141.87867272200003, 45.484035549000055,
142.09652754, 45.372300523000035,
142.9814559250001, 44.58649323100008,
143.368500196, 44.35138580900008,
143.7089949880001, 44.157863674000055,
143.96607506600003, 44.12006256700005,
144.1054793630001, 44.03156159100007,
144.26343834700003, 44.10781484600005,
144.395355665, 43.950873114000046,
145.16667728000004, 44.19049713700008,
145.34945722700002, 44.32599518400008,
145.14429772200003, 43.95294830900008,
145.0747176440001, 43.75372955900008,
145.25212649800005, 43.51430898600006,
145.2583113940001, 43.32709381700005,
145.46843509200005, 43.25299713700008,
145.59489993600005, 43.34284088700008,
145.74439537900003, 43.391791083000044
};


mapdata map_shinura = create_static_mapdata(0,"Urayasu", 68-39+1, map_shinura_coords);
mapdata map_okishima = create_static_mapdata(1,"Okishima", 10, map_okishima_coords);
mapdata map_takeshima = create_static_mapdata(2,"Takeshima", 79-75+1, map_takeshima_coords);
mapdata map_chikubushima = create_static_mapdata(3,"Chikubushima", 94-86+1, map_chikubushima_coords);
mapdata map_biwako = create_static_mapdata(4,"Biwako", 211-116+1, map_biwako_coords);
mapdata map_handaioutside = create_static_mapdata(5,"Handai_O", 302-218+1, map_handaioutside_coords);
mapdata map_handaihighway = create_static_mapdata(6,"Handai_H1", 339-311+1, map_handaihighway_coords);
mapdata map_handaihighway2 = create_static_mapdata(7,"Handai_H2", 359-345+1, map_handaihighway2_coords);
mapdata map_handaiinside1 = create_static_mapdata(8,"Handai_I1",381-366+1 , map_handaiinside1_coords);
mapdata map_handaiinside2 = create_static_mapdata(9,"Handai_I2",391-387+1 , map_handaiinside2_coords);
mapdata map_handaiinside3 = create_static_mapdata(10,"Handai_I3",406-398+1 , map_handaiinside3_coords);
mapdata map_handaiinside4 = create_static_mapdata(11,"Handai_I4", 435-413+1, map_handaiinside4_coords);
mapdata map_handaiinside5 = create_static_mapdata(12,"Handai_I5", 452-444+1, map_handaiinside5_coords);
mapdata map_handairailway = create_static_mapdata(13,"Handai_R", 481-459+1, map_handairailway_coords);
mapdata map_handaicafe = create_static_mapdata(14,"Handai_C", 499-490+1, map_handaicafe_coords);
mapdata map_japan1 = create_static_mapdata(15,"Japan1", 604-507+1, map_japan1_coords);
mapdata map_japan2 = create_static_mapdata(16,"Japan2", 657-610+1, map_japan2_coords);
mapdata map_japan3 = create_static_mapdata(17,"Japan3",912-665+1 , map_japan3_coords);
mapdata map_japan4 = create_static_mapdata(18,"Japan4", 981-919+1, map_japan4_coords);
